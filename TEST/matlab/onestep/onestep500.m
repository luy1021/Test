%a1=2.16;a2=2.15;a3=2.16;a4=2.14;b1=0.23;b2=0.49;b3=0.40;b4=0.64;D1=2.02;D2=2.02;D3=2.02;D4=2.02;r1=0.32;r2=0.31;r3=0.29;r4=0.31;C1=10.00;C2=10.00;C3=10.00;C4=10.00;
%a1=2.17;a2=2.17;a3=2.18;a4=2.14;
%b1=0.15;b2=0.28;b3=0.23;b4=0.61;
%D1=2.02;D2=2.02;D3=2.02;D4=2.02;
%r1=0.32;r2=0.33;r3=0.33;r4=0.30;
%C1=9.00;C2=9.00;C3=9.00;C4=9.00;

%a1=2.16;a2=2.17;a3=2.16;a4=2.17;
a1=2.16;a2=2.17;a3=2.16;a4=2.17;
%b1=0.4;b2=0.2;b3=0.4;b4=0.6;
%b1=0.25;b2=0.28;b3=0.36;b4=0.34;600 601 602 603
%b1=0.26;b2=0.27;b3=0.36;b4=0.34;
b1=0.27;b2=0.26;b3=0.36;b4=0.34;
%r1=0.32;r2=0.31;r3=0.29;r4=0.31;
%r1=0.31;r2=0.33;r3=0.30;r4=0.32;
r1=0.31;r2=0.33;r3=0.30;r4=0.32;
C1=9;C2=9;C3=9;C4=9;
D1=2.02;D2=2.02;D3=2.02;D4=2.02;


x1=0;x2=0;x3=0;x4=0;theta=0.99;

t=1;
p1=[];p2=[];p3=[];p4=[];
q1=[];q2=[];q3=[];q4=[];
pi=[];
while t<=6
f=@(x)(-((1/b1)*x(1)*(a1+r1*log(C1*x(5)+D1)-log(x(1))+log(1-x(1)-x(2)-x(3)-x(4)))+...
    (1/b4)*x(4)*(a4+r4*log(C4*x(8)+D4)-log(x(4))+log(1-x(1)-x(2)-x(3)-x(4)))+...
    (1/b2)*x(2)*(a2+r2*log(C2*x(6)+D2)-log(x(2))+log(1-x(1)-x(2)-x(3)-x(4)))+...
    (1/b3)*x(3)*(a3+r3*log(C3*x(7)+D3)-log(x(3))+log(1-x(1)-x(2)-x(3)-x(4)))+...
    theta*((1/b1)*x(5)*(a1+r1*log(C1*x1+D1)-log(x(5))+log(1-x(5)-x(6)-x(7)-x(8)))+...
    (1/b2)*x(6)*(a2+r2*log(C2*x2+D2)-log(x(6))+log(1-x(5)-x(6)-x(7)-x(8)))+...
    (1/b4)*x(8)*(a4+r4*log(C4*x4+D4)-log(x(8))+log(1-x(5)-x(6)-x(7)-x(8)))+...
    (1/b3)*x(7)*(a3+r3*log(C3*x3+D3)-log(x(7))+log(1-x(5)-x(6)-x(7)-x(8))))));
x0=[0.01;0.01;0.01;0.01;...
    0.01;0.01;0.01;0.01];
lb=[0;0;0;0;...
    0;0;0;0];
ub=[1;1;1;1;...
    1;1;1;1];
[xx1,fval1] = fmincon(f,x0,[],[],[],[],lb,ub);

p11=(1/b1)*(a1+r1*log(C1*x1+D1)-log(xx1(5))+log(1-xx1(5)-xx1(6)-xx1(7)-xx1(8)))%第一期价格
p12=(1/b2)*(a2+r2*log(C2*x2+D2)-log(xx1(6))+log(1-xx1(5)-xx1(6)-xx1(7)-xx1(8)))%第一期价格
p13=(1/b3)*(a3+r3*log(C3*x3+D3)-log(xx1(7))+log(1-xx1(5)-xx1(6)-xx1(7)-xx1(8)))%第一期价格
p14=(1/b4)*(a4+r4*log(C4*x4+D4)-log(xx1(8))+log(1-xx1(5)-xx1(6)-xx1(7)-xx1(8)))%第一期价格
p21=(1/b1)*(a1+r1*log(C1*xx1(5)+D1)-log(xx1(1))+log(1-xx1(1)-xx1(2)-xx1(3)-xx1(4)))%第二期价格
p22=(1/b2)*(a2+r2*log(C2*xx1(6)+D2)-log(xx1(2))+log(1-xx1(1)-xx1(2)-xx1(3)-xx1(4)))%第二期价格
p23=(1/b3)*(a3+r3*log(C3*xx1(7)+D3)-log(xx1(3))+log(1-xx1(1)-xx1(2)-xx1(3)-xx1(4)))%第二期价格
p24=(1/b4)*(a4+r4*log(C4*xx1(8)+D4)-log(xx1(4))+log(1-xx1(1)-xx1(2)-xx1(3)-xx1(4)))%第二期价格

x1 = xx1(1); %第二期市场份额变成第三期的已知量
x2 = xx1(2);
x3 = xx1(3);
x4 = xx1(4);

xx1(5) %第二期市场份额
xx1(6)
xx1(7)
xx1(8)
xx1(1) %第二期市场份额
xx1(2)
xx1(3)
xx1(4)
pi1 = p11*xx1(5)+p12*xx1(6)+p13*xx1(7)+p14*xx1(8)
pi2 = p21*xx1(1)+p22*xx1(2)+p23*xx1(3)+p24*xx1(4)
p1=[p1 p11 p21]
p2=[p2 p12 p22]
p3=[p3 p13 p23]
p4=[p4 p14 p24]
q1=[q1 xx1(5) xx1(1)]
q2=[q2 xx1(6) xx1(2)]
q3=[q3 xx1(7) xx1(3)]
q4=[q4 xx1(8) xx1(4)]
pi=[pi pi1 pi2]
sum(pi)
t=t+1
end
